{% if error %}
    <div class="h-100 border-dark border-1 border d-flex align-items-center justify-content-center">
        <div class="h4 text-danger">{{ error|raw }}</div>
    </div>
{% else %}

    <script type="text/javascript" src="//www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        let chartDiv = document.getElementById('chart_div');

        chartDiv.classList.add('bg-danger');

        fetch('{{ path('yametrika/visitors' }}', {
            method: 'POST', mode: 'cors', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
            }, referrerPolicy: 'no-referrer', // no-referrer, *client
            body: JSON.stringify({
                "wid": {{ widget.id }},
            })
        }).then(function (response) {



            response.json().then(function (datas) {


                google.charts.load('current', {'packages': ['line']});
                google.charts.setOnLoadCallback(drawChart);



                let labels = ['date'];
                labels.push(...Object.keys(datas.totals));

                let values = [];
                for (let i in datas.data) {
                    values[i] = [];
                    values[i].push(datas.data[i]['dimensions']['date']['name']);
                    for (let k in datas.data[i]['metrics']) {
                        values[i].push(datas.data[i]['metrics'][k]);
                    }
                }

                function drawChart() {
                    var data = google.visualization.arrayToDataTable([
                        labels,
                        ...values
                    ]);
                    var options = {
                        title: 'Посещаемость',
                        curveType: 'function',
                        legend: {position: 'bottom'}
                    };

                    var chart = new google.charts.Line(chartDiv);


                    chart.draw(data, options);

                    chartDiv.classList.remove('bg-danger');
                }

            })
        });


    </script>


    <style>
        #chart_div {
            width: 100%;
            max-width: 100%
        }
    </style>
    <div class="card h-100 bg-gradient-light">
        <div class="card-header border-0 ui-sortable-handle" style="cursor: move;">
            <h3 class="card-title">
                <i class="fas fa-map-marker-alt mr-1"></i>
                Visitors
            </h3>

        </div>
        <div class="card-body" id="chart_div">
        </div>

        <div class="card-footer bg-transparent">
            <div class="row">
                <div class="col-4 text-center">
                    <div id="sparkline-1">
                        <canvas width="100" height="62" style="width: 80px; height: 50px;"></canvas>
                    </div>
                    <div>Visitors</div>
                </div>

                <div class="col-4 text-center">
                    <div id="sparkline-2">
                        <canvas width="100" height="62" style="width: 80px; height: 50px;"></canvas>
                    </div>
                    <div>Online</div>
                </div>

                <div class="col-4 text-center">
                    <div id="sparkline-3">
                        <canvas width="100" height="62" style="width: 80px; height: 50px;"></canvas>
                    </div>
                    <div>Sales</div>
                </div>

            </div>

        </div>
    </div>
    <!-- HTML -->

{% endif %}
